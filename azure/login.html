<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenCycle | Login</title>
    <link rel="stylesheet" href="login.css">
    <script>window.gtranslateSettings = {"default_language":"pt","languages":["pt","en"],"wrapper_selector":".gtranslate_wrapper","alt_flags":{"en":"usa","pt":"brazil"}}</script>
<script src="https://cdn.gtranslate.net/widgets/latest/flags.js" defer></script>
</head>

<body>
    <!-- Cabeçalho -->
    <header>
        <nav class="navbar bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img src="images/GreenCycleLogo.jpeg" alt="Logo GreenCycle" class="logo-image">
                    <span class="logo-text">GreenCycle</span>
                </a>
            </div>
            <!-- Menu -->
            <div class="menu-container">
                <ul class="nav-list">
                    <li><a href="index_empresarial.html">Home</a></li>
                    <li><a href="ultima_regulamentacao_pertinente.html">Regulamentação</a></li>
                    <li><a href="credito_de_carbono1.html"> Crédito de Carbono</a></li>
                    <li><a href="relatorio_impacto_ambiental1.html"> RIA</a></li>
                    <li><a href="entenda_pode_ou_nao_ser_reciclado.html">Educacional</a></li>
                    <li><a href="sobre_nos.html">Sobre Nós</a></li>
                   <!-- Dropdown de Alterar Linguagem com ícone do Brasil como padrão -->
                    <li class="language-selector">
                        <button class="language-toggle">
                            <img src="images/PTBR.png" alt="Português" class="flag-icon" />
                        </button>
                        <ul class="gtranslate_wrapper"> </ul>
                    </li>
                    <li class="dropdown">
                        <button class="dropdown-toggle">Acessibilidade</button>
                        <ul class="dropdown-menu">
                            <li><a href="#">Alto Contraste</a></li>
                            <li><a href="#">Modo Daltonismo</a></li>
                            <li><a href="#">VoiceOver</a></li>
                            <li><a href="#">Lupa</a></li>
                        </ul>
                    </li>
                    <button class="login-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                            class="bi bi-person" viewBox="0 0 16 16">
                            <path
                                d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z" />
                        </svg>
                        Login
                    </button>
                </ul>
            </div>
        </nav>
    </header>

   

    <!-- Conteúdo principal -->
    <main>
        <div class="esquerdalogin">
            <!-- Login-->
            <form id="login_form" name="login_form" class="login_form">
                <div class="form-section2">
                    <h2>LOGIN</h2>
                    <label for="email-login">E-mail</label>
                    <input type="email" id="email-login" name="email-login" placeholder="nome@dominio.com">
                    <small id="emailError" style="color: red;"></small>

                    <label for="senha-login">Senha</label>
                    <input type="password" id="senha-login" placeholder="**********">
                    <small id="senhaError" style="color: red;"></small>
                    
                    <button type="submit" onclick="login(event)">Entrar</button>
                </div>
            </form>

            <!-- Segundo formulário: Cadastro -->
            <form id="cadastro_form" name="cadastro_form" class="cadastro_form">

            <!-- sessão de criação de conta -->
            <div class="direitalogin">
                <h2>Criar Conta</h2>
                <label for="nome">Nome</label>
                <input type="text" id="nomeCadastro" placeholder="Nome Completo">
                <small id="nomeCadastroError" style="color: red;"></small>

                <label for="email">E-mail</label>
                <input type="email" id="emailCadastro" placeholder="nome@dominio.com">
                <small id="emailCadastroError" style="color: red;"></small>

                <label for="senha">Senha</label>
                <input type="password" id="senhaCadastro" placeholder="**********">
                <small id="senhaCadastroError" style="color: red;"></small>

                <label for="senha2">Confirme a Senha</label>
                <input type="password" id="senhaCadastro2" placeholder="**********">
                <small id="senhaCadastro2Error" style="color: red;"></small>

                <div class="form-check">
                    <input type="checkbox" id="termos">
                    <label for="termos">Li e concordo com os termos e condições</label>
                </div>

                <small id="termos_e_condicoesError" style="color: red;"></small>

                <div class="toggle-container">
                    <h3 for="toggle-industries">Sou uma empresa</h3>
                    <label class="switch">
                        <input type="checkbox" id="toggle-industries">
                        <span class="slider round"></span>
                    </label>
                </div>
                
                <div class="toggle-container">
                    <button type="submit" onclick="criarConta()">Criar Conta</button>
                </div>
                
                <script>
                    
                </script>
        </div>
    </main>

    <!-- Rodapé -->
    <footer>
        <div class="footer">
            <div class="container">
                <span>© 2024 GreenCycle™. Todos os direitos reservados.</span>
                <ul class="footer-links">
                    <li><a href="ultima_regulamentacao_pertinente.html">Regulamentação</a></li>
                    <li><a href="entenda_pode_ou_nao_ser_reciclado.html">Educacional</a></li>
                    <li><a href="sobre_nos.html">Sobre Nós</a></li>
                    <li><a>Política de Privacidade</a></li>
                </ul>
            </div>
        </div>
    </footer>


    <script>
        // Função para validar o formulário 1 - LOGIN
        document.getElementById('login_form').addEventListener('submit', function(event) {
            let isValid = true;

            // Validar o email
            const email = document.getElementById('email-login');
            const erroEmail = document.getElementById('emailError');
            if (email.value.trim() === "" || !email.validity.valid) {
                isValid = false;
                erroEmail.textContent = "Informe um email válido.";
                document.getElementById("emailError").textContent = "Informe um email válido.";
                event.preventDefault();
            } else {
                erroEmail.textContent = "";
            }

            // Validar senha
            const nome = document.getElementById('senha-login');
            const erroNome = document.getElementById('senhaError');
            if (nome.value.trim() === "") {
                isValid = false;
                erroNome.textContent = "Digite sua senha";
            } else {
                erroNome.textContent = "";
            }

            // Se não for válido, prevenir envio
            if (!isValid) {
                event.preventDefault();
            }
        });

        // Função para validar o formulário 2 - CADASTRO
        document.getElementById('cadastro_form').addEventListener('submit', function(event) {
            let isValid2 = true;

            /* 
            
                nomeCadastro
                nomeCadastroError


                emailCadastro
                emailCadastroError


                senhaCadastro
                senhaCadastroError

                senha-confirm
                senha-confirmError

            */


            //Validar o nome de cadastro
            const nomeCadastro = document.getElementById('nomeCadastro');
            const nomeCadastroError = document.getElementById('nomeCadastroError');
            if (nomeCadastro.value.trim() === "" || !nomeCadastro.validity.valid) {
                isValid2 = false;
                nomeCadastroError.textContent = "Informe um nome de cadastro válido.";
                document.getElementById("nomeCadastroError").textContent = "Informe um nome de cadastro válido.";
                event.preventDefault();
            } else {
                nomeCadastroError.textContent = "";
            }
            
            // Validar o email
            const emailCadastro = document.getElementById('emailCadastro');
            const erroEmail = document.getElementById('emailCadastroError');
            if (emailCadastro.value.trim() === "" || !emailCadastro.validity.valid) {
                isValid2 = false;
                erroEmail.textContent = "Informe um email válido.";
                document.getElementById("emailCadastroError").textContent = "Informe um email válido.";
                event.preventDefault();
            } else {
                erroEmail.textContent = "";
            }

            // Validar senha
            const senhaCadastro = document.getElementById('senhaCadastro');
            const senhaCadastroError = document.getElementById('senhaCadastroError');
            if (senhaCadastro.value.trim() === "") {
                
                senhaCadastroError.textContent = "Digite sua senha";
                isValid2 = false;
                event.preventDefault();
            } else {
                senhaCadastroError.textContent = "";
            }

            // Validar confirmação de senha
            const senhaCadastro2 = document.getElementById('senhaCadastro2');
            const senhaCadastro2Error = document.getElementById('senhaCadastro2Error');
            if (senhaCadastro2.value.trim() === "") {
                senhaCadastro2Error.textContent = "Digite sua senha novamente";
                isValid2 = false;
                event.preventDefault();
            } else {
                // senhaCadastro2Error.textContent = "";

                if (senhaCadastro != senhaCadastro2){
                    senhaCadastro2Error.textContent = "As senhas tem que coincidir";
                    isValid2 = false;
                    event.preventDefault();
                }else {
                    senhaCadastro2Error.textContent = "";
                }
            }

            

            //Valida termos
            var termosAceitos = document.getElementById("termos").checked;
            var isEmpresa = document.getElementById("toggle-industries").checked;
    
            if (!termosAceitos) {

                document.getElementById("termos_e_condicoesError").textContent = "Você precisa concordar com os termos e condições.";

                isValid2 = false;
                event.preventDefault();
                // alert("Você precisa concordar com os termos e condições.");
                return; 
            }
    
            // Se não for válido, prevenir envio
            if (!isValid2) {
                event.preventDefault();
            }

        });


        //Validacão dos termos e condições
        function criarConta() 
        {
            var termosAceitos = document.getElementById("termos").checked;
            var isEmpresa = document.getElementById("toggle-industries").checked;
    
            if (!termosAceitos) {

                document.getElementById("termos_e_condicoesError").textContent = "Você precisa concordar com os termos e condições.";
                // alert("Você precisa concordar com os termos e condições.");
                return; 
            }

            saveData(isEmpresa)

            if (isEmpresa) {
                window.location.href = 'planos_empresariais.html'; 
            } else {
                window.location.href = 'perfil_usuario.html'; 
            }
        }
        
        function saveData(isEmpresa){
    
        let name, email, password;

        name = document.getElementById("nomeCadastro").value;
        email = document.getElementById("emailCadastro").value;
        password = document.getElementById("senhaCadastro").value;

        localStorage.setItem("name", name);
        localStorage.setItem("email", email);
        localStorage.setItem("password", password);
        localStorage.setItem("business", isEmpresa);

        let user_records = new Array();
        user_records = JSON.parse(localStorage.getItem("users"))?JSON.parse(localStorage.getItem("users")):[]
        if (user_records.some((v) => {
            return v.email == email
        })){
            alert("Já existe um usuário cadastrado com esse e-mail.");
        }
        else {
            user_records.push({
                "name": name,
                "email": email,
                "password": password,
                "business": isEmpresa
            })

            localStorage.setItem("users", JSON.stringify(user_records));
            }

        }

        function login(){
        event.preventDefault();

        console.log("logar html")

        let email, password;

        email = document.getElementById("email-login").value;
        password = document.getElementById("senha-login").value;

        let user_records = new Array();
        user_records = JSON.parse(localStorage.getItem("users"))?JSON.parse(localStorage.getItem("users")):[];

        if (user_records.some((v) => {
            return v.email == email && v.password === password
        })){
            alert("Login realizado.")
            let current_user = user_records.filter((v) => {
                return v.email == email && v.password == password;
            })[0]

            localStorage.setItem("name", current_user.name);
            localStorage.setItem("email", current_user.email);
            localStorage.setItem("business", current_user.business);

            if(current_user.business){
                console.log("if buss")
                window.location.href = 'planos_empresariais.html'; 
            } else {
                console.log("if notb")
                window.location.href = 'perfil_usuario.html'; 
            }

            console.log("fim")
        }

        else {
            alert("Dados incorretos.")
            }
        }
    </script>

</body>

</html>
